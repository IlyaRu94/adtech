# SF-Adtech. Описание

SF-Adtech - это платформа для работы с офферами. Рекламодатель размещает офферы, на которые желает привлечь клиентов. Мастер добавляет оффер себе в список и получает уникальную ссылку, за размещение которой он может получить вознаграждение.
Данная платформа уникальна тем, что рекламодатель и мастер имеют один лицевой счет, то есть каждый рекламодатель может зарабатывать на "чужих" офферах, и каждый мастер может рекламировать свои ссылки, используя заработок в системе. Платформа оставляет всего 20% комиссии за операции.
В системе 3 роли: администратор, рекламодатель и матер. Роли рекламодателя и мастера при авторизации на полтале выбирает сам пользователь. Администратор независимо от выфбранной роли заходит в особенный интерфейс с дополнительными функциями. Администратора назначает администратор, добавляя в базу пользователя необходимое полномочие.Администратор системы занимается контролем системы и не может зарабатывать, создавая свои офферы (создавать он их может, но этот функционал нужен для редактирования и назначения офферов другим пользователям).

## Функции, реализованные на платформе

1. Авторизация и регистрация, выбор роли.
2. Запись и просмотр статистики переходов и отказов по ссылкам. 5-ступенчатый анализ доступности ссылки.
3. Статистика кликов, заработанных средств для мастеров в разрезе день/месяц/год/все всемя по каждому офферу.
4. Статистика кликов по офферу, подписавшихся мастеров, истраченных денег в разрезе день/месяц/год/все время по каждому офферу для рекламодателей.
5. Создание новых офферов для рекламодателей и их изменение.
6. Поиск по созданным ифферам и вывод всех офферов платформы.
7. Загрузка страниц с использованием ассинхронных запросов.
8. Работоспособность с выключенным js
9. Начисление и расход денежных средств с учетом прозрачной комиссии платформы -20%.
10. Полный контроль адлминистратора над пользователями и офферами.
11. Для анализа действий пользователей - в базу сохраняется ip и дата с временем последнего посещения пользователем портала.

## Про стандарты в приложении

SF-Adtech - это приложение, выполненное по стандартам Объектно-ориентированного программирования и MVC - module - view - controller. Используется плагин RedBean для работы с базой данных. В остальном - "чистый" PHP и JS. БЭМ-оподобная верстка с соблюдением стандартов HTML5.
Большинство классов в приложении являются самостоятельными. С помощью них можно разрабатывать свои плагины и менять логику программы в целом.

## Запуск

Приложение сделано в docker. Для запуска используйте команду sudo docker compose up -d --build
Если нет docker и composer - можно разместить папку src у себя на хостинге.
Настройки redbean находятся в файле src/public/core/model.php
В папке с проектом есть тестовая база данных adtech.sql, для демонстрации возможностей, рекомендуется ее загрузить. Стандартные логин и пароль администратора: ** superAdmin / 0852admin **. Остальные пользователи имеют пароль 1234

## Модели и контроллеры регистрации и авторизации

### model_user.php, model_login.php, controller_login.php, login_view.php, model_register.php, controller_register, register_view.php

**Основные запросы регистрации и авторизации пользователей сосредоточена в файле model_user.php**
модель *class User(Логин, Пароль, Имя, Админ?=0)* необходима для создания новых пользователей (функция *setRegisterUser()*) или проверки (авторизации) пользователей (функция *getCheckUser()*).
Авторизация и регистрация валидируется в контроллерах *function action_index()* одноименных файлов.

## Модели и контроллеры админки

### model_login.php, controller_admin.php, admin_view.php

*Controller_admin* обрабатывает стриничку авторизованных пользователей: функция контроллера *action_index()* с помощью кросс-запросов к моделям model_offer.php и model_offermaster.php подготавливает списки персональных офферов для мастера и рекламодателя, показывает на экране баланс лицевого счета. Функция *action_search()* необхолдима для поиска на платформе своих и общих офферов. Для мастеров в общем списке реализована возможность выбора офферов и их добавления в свой список.
Переключение между общим списком и своими добавленными офферами осуществляется путем нажатия кнопки "показать все офферы".

## Модели и контроллеры офферов

### model_offer.php, controller_offer.php, offer_view.php

Модель *class Model_Offer(Имя_оффера, Цена_оффера, Тема_оффера, УРЛ_оффера, ИД_пользователя, Активность_оффера, Ид_оффера='', Страница_с_офферами=0, Лимит_элементов_на_странице=5)* необходима для добавления  и изменения офферов рекламодателями (функция *setOffer()*), а так же для получения имеющихся офферов (функция *getOffer()*).
Модель *Model_Offer_count (ид_оффера, ид_пользователя='')* нужна для подсчета количества мастеров, подписанных на оффер (всего по платформе или для конкретного рекламодателя). Так же в данном классе реализована возможность удаления офферов.
Функция контроллера *function action_index()* отвечает для отображения подробной информации о выбранном оффере. Так же благодаря данной функции есть возможность просмотра статистики расхода, кликов и количества подписавшихся офферов за день/месяц/год/все время.
*function action_delete()* - удаляет оффер.

## Модели и контроллеры Офферов для мастеров

### model_offermaster.php, controller_offermaster.php, offermaster_view.php

Для мастеров реализованна отдельная модель *Model_Offermaster(ИД_оффера, ИД_Пользователя, Страница_с_офферами='0', Лимит_офферов_на_странице=5, Имя_оффера='', Тема_оффера='')*. Функция *setOffer()* в данной модели добавляет выбранный оффер в список офферов мастера. *getOfferAll()* - выводит офферы, соответствующие условиям поиска или весь список. *getOfferDelete()* - удаляет из списка офферпов мастера оффер.
Контроллер *action_add(ИД_оффера)* - контроллирует вывод данных согласно заданным критериям. *action_delete()* - контроллирует удаление оффера из списка мастера.
Модель *class postFilter(Данные)* нужна для фильтрации и валидации приходящих на сервер post и get данных. *checkPost()*, *checkNum()*, *checkUrl()* - проверяют на запрещенные символы текст, число и url.
Модель *class postClear(Данные)* нужен для очистки данных от зхапрещенных символов.

## Модели и контроллеры Редиректа

### model_redirect.php, controller_redirect.php, redirect_view.php

Система редиректов реализована с помощью модели *class Model_Redirect(ИД_оффера='0', url_выданный_мастеру, Статус_перехода='0', ИД_Мастера='0',Стоимость_оффера='0')*. В данном модуле функция *redirectSave()* сохраняет любые переходы по ссылкам. Функция *redirectCheckMaster()* проверяет и возвращает результат, есть ли оффер в списке мастера. *redirectCheckOffer()* - необходим для получения статуса активности оффера, его стоимости и его прямого URL.
Контроллер с помощью функции *function action_url(url_выданный_мастеру)* производит проверки и выдает ссылку на оффер, или перенаправляет клиента на страницу 404. Функция *function savestatus* передает любые действия модели для сохранения.

## Немного о статусах перехода по ссылкам

Существует 5 статусов ссылки:

+ 5 - Ссылка выдана, переход совершен
+ 4 - Мастер заблокирован администратором, переход не совершен, ссылка не выдана, деньги не начислены
+ 3 - Рекламодатель заблокирован администратором, переход не совершен, ссылка не выдана, деньги не начислены
+ 2 - Оффер отсутствует в списке мастера, мастер отписан от оффера, переход не совершен, ссылка не выдана, деньги не начислены
+ 1 - Оффер деактивирован рекламодателем, переход не совершен, ссылка не выдана, деньги не начислены

## Модели и контроллеры бюджета и статистики

### model_budget.php, controller_budget.php, budget_view.php

Модель *class Model_Budget(Период_времени=0, url_мастера='', Статус_перехода_по_ссылке='',  ИД_Мастера='', ИД_оффера='', Стоимость_оффераe='', Страница_статистики=0, Количество_элементов_на_странице=5)* получает из базы данных статистику по ссылкам, в зависимости от заданных контроллером условий. Функция *getStat()* возвращает найденное.
Контроллер с функцией *action_index()* фильтрует поступающие данные и отправляет подготовленную статистику на вывод.
**Статистика по заработку и кликам, отображаемая в верхней части документа, изменяется в зависимости от выставленных фильтров. Подобный функционал помогает анализировать данные в различных разрезах данных.**

## Модели и контроллеры редактирования пользователей

### model_edituser.php, controller_edituser.php, edituser_view.php

Модель *class Model_Edituser (ИД_пользователя, Логин, Пароль='',Баланс_лицевого_счета, Автивирован_пользователь?(да(1)/нет(0)), Админ?(да(1)/нет(0)), Имя_пользователя)* нужна для вывода из базы имеющихся пользователей и их создания и редактирования администратором.
Контроллер *action_edit(ИД_Пользователя)* необходим для создания и редактирования пользователя. Если не передавать ИД_пользователя - будет создан новый пользователль. *function action_delete()* - удаляет пользователя.

## Прочие модели и контроллеры

### model_contacts.php, controller_contacts.php, contacts_view.php

Модель *class Model_contacts* содержит данные для публикации на странице контактов. Контроллер *class Controller_contacts* перенаправляет данные в шаблон вывода.

### model_404.php, controller_404.php, 404_view.php, model_main.php, controller_main.php, main_view.php

Контроллеры class Controller_404 и class Controller_Main нужны для отображения страницы ошибки и главной страницы

### template_view.php

Шаблон вывода template_view.php является общим шаблоном оформления сайта.
